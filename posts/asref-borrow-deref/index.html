<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         AsRef vs Borrow vs Deref Busted
        
    </title><meta content="AsRef vs Borrow vs Deref Busted" property=og:title><meta content="Welcome to my personal site where I share my thoughts, projects, and experiences." property=og:description><meta content="Welcome to my personal site where I share my thoughts, projects, and experiences." name=description><link href=/icon/favicon.png rel=icon type=image/png><link href=https://artech-git.github.io/fonts.css rel=stylesheet><script src=https://artech-git.github.io/js/codeblock.js></script><script src=https://artech-git.github.io/js/toc.js></script><script src=https://artech-git.github.io/js/note.js></script><script>MathJax={tex:{inlineMath:[[`\$`,`\$`],[`\\\\(`,`\\\\)`]]}}</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link href=https://artech-git.github.io/atom.xml rel=alternate title=artech type=application/atom+xml><link href=https://artech-git.github.io/theme/light.css rel=stylesheet><link href=https://artech-git.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://artech-git.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme())</script><link href=https://artech-git.github.io/main.css media=screen rel=stylesheet><body><div class=content><header><div class=main><a href=https://artech-git.github.io/>artech</a><div class=socials><a class=social href=https://github.com/artech-git/ rel=me> <img alt=github src=https://artech-git.github.io/social_icons/github.svg> </a><a class=social href=https://www.linkedin.com/in/prabhat25/ rel=me> <img alt=linked src=https://artech-git.github.io/social_icons/linkedin.svg> </a></div></div><nav><a href=https://artech-git.github.io/posts style=margin-left:.5em>/posts</a><a href=https://artech-git.github.io/projects style=margin-left:.5em>/projects</a><a href=https://artech-git.github.io/courses style=margin-left:.5em>/courses</a><a href=https://artech-git.github.io/books style=margin-left:.5em>/books</a><a href=https://artech-git.github.io/resume style=margin-left:.5em>/resume</a><a href=https://artech-git.github.io/talks style=margin-left:.5em>/talks</a><a href=https://artech-git.github.io/certs style=margin-left:.5em>/certs</a><a href=https://artech-git.github.io/about style=margin-left:.5em>/about</a> |<a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://artech-git.github.io/feather/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://artech-git.github.io/feather/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><main><article><div class=title><div class=page-header>AsRef vs Borrow vs Deref Busted<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2024-07-09</time><span class=tags-label> :: Tags:</span><span class=tags> <a class=post-tag href=https://artech-git.github.io/tags/coding/>coding</a> </span> :: <a rel="noopener noreferrer" href=https://github.com/artech-git/artech-git.github.io/tree/main/contentposts/asref_borrow_deref.md target=_blank> Source Code</a></div></div><div class=toc-container><h1 class=toc-title>Table of Contents</h1><ul class=toc-list><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#asref-vs-borrow-vs-deref-in-rust>AsRef vs Borrow vs Deref in Rust</a> <ul><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#asref>AsRef</a></li><ul><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#common-use-cases>Common Use Cases</a></ul><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#borrow>Borrow</a></li><ul><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#use-cases>Use Cases</a><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#key-differences-from-asref>Key Differences from AsRef</a></ul><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#deref>Deref</a></li><ul><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#common-use-cases-1>Common Use Cases</a><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#deref-coercion>Deref Coercion</a></ul><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#comparison-table>Comparison Table</a><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#when-to-use-each>When to Use Each</a></li><ul><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#use-asref-when>Use AsRef when:</a><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#use-borrow-when>Use Borrow when:</a><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#use-deref-when>Use Deref when:</a></ul><li><a href=https://artech-git.github.io/posts/asref-borrow-deref/#common-gotchas>Common Gotchas</a></ul></ul></div><section class=body><p>Havn't you come across the trait <code>AsRef&LTT></code> , <code>Borrow</code> and <code>Deref</code><h1 id=asref-vs-borrow-vs-deref-in-rust><a aria-label="Anchor link for: asref-vs-borrow-vs-deref-in-rust" class=zola-anchor href=#asref-vs-borrow-vs-deref-in-rust>AsRef vs Borrow vs Deref in Rust</a></h1><h2 id=asref><a aria-label="Anchor link for: asref" class=zola-anchor href=#asref>AsRef</a></h2><p><code>AsRef</code> is a trait for performing cheap reference-to-reference conversions. It's most commonly used for functions that can accept multiple types of string references.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>AsRef</span><span>&LTT: ?Sized> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>as_ref</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span>T</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=common-use-cases><a aria-label="Anchor link for: common-use-cases" class=zola-anchor href=#common-use-cases>Common Use Cases</a></h3><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>process_string</span><span>&LTT</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>AsRef</span><span><</span><span style=color:#fa6e32>str</span><span>>>(</span><span style=color:#ff8f40>s</span><span style=color:#61676ccc>:</span><span> T) {
</span><span>    </span><span style=color:#fa6e32>let</span><span> s_ref</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str </span><span style=color:#ed9366>=</span><span> s</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>()</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Process the string slice
</span><span>}
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Can be called with different types
</span><span style=color:#fa6e32>let</span><span> string </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>String</span><span style=color:#ed9366>::</span><span>from(</span><span style=color:#86b300>"hello"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>let</span><span> str_literal </span><span style=color:#ed9366>= </span><span style=color:#86b300>"world"</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#f07171>process_string</span><span>(</span><span style=color:#ed9366>&</span><span>string)</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// works
</span><span style=color:#f07171>process_string</span><span>(str_literal)</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// also works
</span></code></pre><h2 id=borrow><a aria-label="Anchor link for: borrow" class=zola-anchor href=#borrow>Borrow</a></h2><p><code>Borrow</code> is similar to <code>AsRef</code> but with an additional contract: the borrowed form must hash, compare, and order the same as the owned form.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>Borrow</span><span>&LTBorrowed: ?Sized> {
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>borrow</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span>Borrowed</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=use-cases><a aria-label="Anchor link for: use-cases" class=zola-anchor href=#use-cases>Use Cases</a></h3><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>collections</span><span style=color:#ed9366>::</span><span>HashMap</span><span style=color:#61676ccc>;
</span><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>borrow</span><span style=color:#ed9366>::</span><span>Borrow</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>let mut</span><span> map </span><span style=color:#ed9366>= </span><span>HashMap</span><span style=color:#ed9366>::</span><span>new()</span><span style=color:#61676ccc>;
</span><span>map</span><span style=color:#ed9366>.</span><span style=color:#f07171>insert</span><span>(</span><span style=color:#55b4d4;font-style:italic>String</span><span style=color:#ed9366>::</span><span>from(</span><span style=color:#86b300>"key"</span><span>)</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>42</span><span>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Can lookup with &str because String: Borrow&LTstr>
</span><span style=color:#f07171>assert_eq!</span><span>(map</span><span style=color:#ed9366>.</span><span style=color:#f07171>get</span><span>(</span><span style=color:#86b300>"key"</span><span>)</span><span style=color:#61676ccc>, </span><span style=color:#55b4d4;font-style:italic>Some</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>42</span><span>))</span><span style=color:#61676ccc>;
</span></code></pre><h3 id=key-differences-from-asref><a aria-label="Anchor link for: key-differences-from-asref" class=zola-anchor href=#key-differences-from-asref>Key Differences from AsRef</a></h3><ol><li>Stricter semantic requirements<li>Essential for hash maps and collections</ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Borrow guarantees that these are equivalent:
</span><span style=color:#f07171>hash</span><span>(owned_value) </span><span style=color:#ed9366>== </span><span style=color:#f07171>hash</span><span>(borrowed_value)
</span><span>owned_value </span><span style=color:#ed9366>==</span><span> owned_value2 ‚ü∫ borrowed_value </span><span style=color:#ed9366>==</span><span> borrowed_value2
</span></code></pre><h2 id=deref><a aria-label="Anchor link for: deref" class=zola-anchor href=#deref>Deref</a></h2><p><code>Deref</code> is used for dereferencing operations using the <code>*</code> operator and for automatic dereferencing.<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>pub trait </span><span style=color:#399ee6>Deref </span><span>{
</span><span>    </span><span style=color:#fa6e32>type </span><span style=color:#399ee6>Target</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>?</span><span style=color:#55b4d4;font-style:italic>Sized</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>deref</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>Self</span><span style=color:#ed9366>::</span><span>Target</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=common-use-cases-1><a aria-label="Anchor link for: common-use-cases-1" class=zola-anchor href=#common-use-cases-1>Common Use Cases</a></h3><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>ops</span><span style=color:#ed9366>::</span><span>Deref</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>MyBox</span><span>&LTT>(T)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl</span><span>&LTT> Deref </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>MyBox</span><span>&LTT> {
</span><span>    </span><span style=color:#fa6e32>type </span><span style=color:#399ee6>Target </span><span style=color:#ed9366>=</span><span> T</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>deref</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span>T {
</span><span>        </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0
</span><span>    }
</span><span>}
</span><span>
</span><span style=color:#fa6e32>let</span><span> x </span><span style=color:#ed9366>=</span><span> MyBox(</span><span style=color:#ff8f40>5</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>assert_eq!</span><span>(</span><span style=color:#ff8f40>5</span><span style=color:#61676ccc>, </span><span style=color:#ed9366>*</span><span>x)</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Deref coercion
</span></code></pre><h3 id=deref-coercion><a aria-label="Anchor link for: deref-coercion" class=zola-anchor href=#deref-coercion>Deref Coercion</a></h3><p>One of the most powerful features of <code>Deref</code>:<pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>takes_str</span><span>(</span><span style=color:#ff8f40>s</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>str</span><span>) {
</span><span>    </span><span style=color:#f07171>println!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> s)</span><span style=color:#61676ccc>;
</span><span>}
</span><span>
</span><span style=color:#fa6e32>let</span><span> string </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>String</span><span style=color:#ed9366>::</span><span>from(</span><span style=color:#86b300>"hello"</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>takes_str</span><span>(</span><span style=color:#ed9366>&</span><span>string)</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Works because String: Deref&LTTarget=str>
</span></code></pre><h2 id=comparison-table><a aria-label="Anchor link for: comparison-table" class=zola-anchor href=#comparison-table>Comparison Table</a></h2><table><thead><tr><th>Trait<th>Primary Purpose<th>Key Characteristics<tbody><tr><td><code>AsRef</code><td>Cheap reference conversions<td>- No guarantees about equality or hashing<br>- Useful for generic functions accepting references<tr><td><code>Borrow</code><td>Borrowed data equivalence<td>- Guarantees about equality and hashing<br>- Essential for collections like HashMap<tr><td><code>Deref</code><td>Smart pointer functionality<td>- Enables <code>*</code> operator<br>- Enables deref coercion<br>- Affects method resolution</table><h2 id=when-to-use-each><a aria-label="Anchor link for: when-to-use-each" class=zola-anchor href=#when-to-use-each>When to Use Each</a></h2><h3 id=use-asref-when><a aria-label="Anchor link for: use-asref-when" class=zola-anchor href=#use-asref-when>Use AsRef when:</a></h3><ul><li>Writing generic functions that need reference conversions<li>No need for hash/equality guarantees</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>fn </span><span style=color:#f29718>print_contents</span><span>&LTT</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>AsRef</span><span><</span><span style=color:#fa6e32>str</span><span>>>(</span><span style=color:#ff8f40>s</span><span style=color:#61676ccc>:</span><span> T) {
</span><span>    </span><span style=color:#f07171>println!</span><span>(</span><span style=color:#86b300>"</span><span style=color:#ff8f40>{}</span><span style=color:#86b300>"</span><span style=color:#61676ccc>,</span><span> s</span><span style=color:#ed9366>.</span><span style=color:#f07171>as_ref</span><span>())</span><span style=color:#61676ccc>;
</span><span>}
</span></code></pre><h3 id=use-borrow-when><a aria-label="Anchor link for: use-borrow-when" class=zola-anchor href=#use-borrow-when>Use Borrow when:</a></h3><ul><li>Working with collections<li>Need hash/equality guarantees</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>use </span><span>std</span><span style=color:#ed9366>::</span><span>collections</span><span style=color:#ed9366>::</span><span>HashSet</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>let</span><span> set</span><span style=color:#61676ccc>: </span><span>HashSet<</span><span style=color:#55b4d4;font-style:italic>String</span><span>> </span><span style=color:#ed9366>= </span><span>[</span><span style=color:#86b300>"a"</span><span style=color:#61676ccc>, </span><span style=color:#86b300>"b"</span><span>]</span><span style=color:#ed9366>.</span><span style=color:#f07171>iter</span><span>()</span><span style=color:#ed9366>.</span><span style=color:#f07171>map</span><span>(|</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>s</span><span>| s</span><span style=color:#ed9366>.</span><span style=color:#f07171>to_string</span><span>())</span><span style=color:#ed9366>.</span><span style=color:#f07171>collect</span><span>()</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>assert!</span><span>(set</span><span style=color:#ed9366>.</span><span style=color:#f07171>contains</span><span>(</span><span style=color:#86b300>"a"</span><span>))</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// Works because of Borrow
</span></code></pre><h3 id=use-deref-when><a aria-label="Anchor link for: use-deref-when" class=zola-anchor href=#use-deref-when>Use Deref when:</a></h3><ul><li>Implementing smart pointer types<li>Need automatic dereferencing behavior</ul><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#fa6e32>struct </span><span style=color:#399ee6>SmartPtr</span><span>&LTT>(</span><span style=color:#55b4d4;font-style:italic>Box</span><span>&LTT>)</span><span style=color:#61676ccc>;
</span><span>
</span><span style=color:#fa6e32>impl</span><span>&LTT> Deref </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>SmartPtr</span><span>&LTT> {
</span><span>    </span><span style=color:#fa6e32>type </span><span style=color:#399ee6>Target </span><span style=color:#ed9366>=</span><span> T</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>deref</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span>T { </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span>}
</span><span>}
</span></code></pre><h2 id=common-gotchas><a aria-label="Anchor link for: common-gotchas" class=zola-anchor href=#common-gotchas>Common Gotchas</a></h2><ol><li><strong>Deref Coercion Costs</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Multiple deref coercions can have performance implications
</span><span style=color:#fa6e32>let</span><span> s </span><span style=color:#ed9366>= </span><span style=color:#55b4d4;font-style:italic>Box</span><span style=color:#ed9366>::</span><span>new(</span><span style=color:#55b4d4;font-style:italic>String</span><span style=color:#ed9366>::</span><span>from(</span><span style=color:#86b300>"hello"</span><span>))</span><span style=color:#61676ccc>;
</span><span style=color:#f07171>takes_str</span><span>(</span><span style=color:#ed9366>&</span><span>s)</span><span style=color:#61676ccc>;  </span><span style=color:#abb0b6;font-style:italic>// Box -> String -> str, two dereferences
</span></code></pre><ol start=2><li><strong>Borrow vs AsRef Choice</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Wrong choice for HashMap key type
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>bad_design</span><span>&LTT</span><span style=color:#61676ccc>: </span><span style=color:#55b4d4;font-style:italic>AsRef</span><span><</span><span style=color:#fa6e32>str</span><span>>>(</span><span style=color:#ff8f40>map</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>HashMap&LTT, </span><span style=color:#fa6e32>u32</span><span>>) {} </span><span style=color:#abb0b6;font-style:italic>// Won't work well
</span><span>
</span><span style=color:#abb0b6;font-style:italic>// Correct choice
</span><span style=color:#fa6e32>fn </span><span style=color:#f29718>good_design</span><span>&LTT</span><span style=color:#61676ccc>: </span><span>Borrow<</span><span style=color:#fa6e32>str</span><span>>>(</span><span style=color:#ff8f40>map</span><span style=color:#61676ccc>: </span><span style=color:#ed9366>&</span><span>HashMap&LTT, </span><span style=color:#fa6e32>u32</span><span>>) {}
</span></code></pre><ol start=3><li><strong>Deref for Non-Pointer Types</strong></ol><pre class=language-rust data-lang=rust style=color:#61676c;background-color:#fafafa><code class=language-rust data-lang=rust><span style=color:#abb0b6;font-style:italic>// Generally avoid implementing Deref for non-pointer-like types
</span><span style=color:#abb0b6;font-style:italic>// Could be confusing for other developers
</span><span style=color:#fa6e32>struct </span><span style=color:#399ee6>Seconds</span><span>(</span><span style=color:#fa6e32>u64</span><span>)</span><span style=color:#61676ccc>;
</span><span style=color:#abb0b6;font-style:italic>// Avoid this:
</span><span style=color:#fa6e32>impl </span><span>Deref </span><span style=color:#fa6e32>for </span><span style=color:#399ee6>Seconds </span><span>{
</span><span>    </span><span style=color:#fa6e32>type </span><span style=color:#399ee6>Target </span><span style=color:#ed9366>= </span><span style=color:#fa6e32>u64</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#fa6e32>fn </span><span style=color:#f29718>deref</span><span>(</span><span style=color:#ed9366>&</span><span style=color:#ff8f40>self</span><span>) </span><span style=color:#61676ccc>-> </span><span style=color:#ed9366>&</span><span style=color:#fa6e32>u64 </span><span>{ </span><span style=color:#ed9366>&</span><span style=color:#55b4d4;font-style:italic>self</span><span style=color:#ed9366>.</span><span style=color:#ff8f40>0 </span><span>}
</span><span>}
</span></code></pre><p>This overview covers the main differences and use cases for these three important Rust traits. The key is understanding their specific purposes and contracts to use them effectively in your code.</section></article></main><div class=giscus></div><script async crossorigin issue-term=pathname repo=not-matthias/apollo src=https://utteranc.es/client.js theme=github-light></script></div>